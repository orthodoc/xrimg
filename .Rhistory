#     no = file.path("~/projects/R/xr/xray/img", str_c(indice, "-", basename(url)))
#   )
#   tryCatch(download.file(url, filepath, mode = "wb"),
#            error = function(e) {
#              print(e)
#              print(indice)
#              return(indice)
#              err <<- c(err, indice)
#            })
#   print('All saved')
# }
}
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
temp.img.list
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
temp.img.list <- img.list[112223:112225,]
temp.img.list
temp.img.list <- img.list[112223:112224,]
temp.img.list
apply(temp.img.list, 1, get.img)
apply(temp.img.list, 1, get.img)
temp.img.list <- img.list[1:3,]
apply(temp.img.list, 1, get.img)
get.nih.list()
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
get.nih.list()
nih.img.list <- get.nih.list()
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
temp.img.list
apply(temp.img.list, 1, get.img)
temp.img.list <- img.list[1:2, ]
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
image_read(temp.img.list$imgURL[1])
img <- image_read(temp.img.list$imgURL[1])
image_convert(img, format = "png")
str_extract(temp.img.list$imgURL[1], temp.img.list$uid[1]) == temp.img.list$uid
filepath <- file.path("img", str_c(temp.img.list$uid[1], "-", basename(temp.img.list$imgURL[1])))
image_write(img, filepath)
!NA
str_extract(temp.img.list$imgURL[1], temp.img.list$uid[1]) == NA
str_extract(temp.img.list$imgURL[1], temp.img.list$uid[1]) != NA
is.na(str_extract(temp.img.list$imgURL[1], temp.img.list$uid[1]))
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
temp.img.list
apply(temp.img.list, 1, get.img)
temp.img.list <- img.list[1:10,]
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
temp.img.list
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
temp.img.list
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
img
typeof(img)
class(img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
temp.img.list[3]
temp.img.list[[3]]
temp.img.list[[3,]]
temp.img.list[,3]
temp.img.list[3,]
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
temp.img.list[3,]
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
apply(nih.img.list, 1, get.img)
temp.img.list
temp.img.list <- img.list[123456:123455]
temp.img.list <- img.list[123456:123455,]
temp.img.list
temp.img.list <- img.list[123456:123465,]
temp.img.list
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
ortho.img.list <- get.ortho.list()
rm(ortho.img.list)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
head(img.list,5)
tail(img.list,5)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
get.img.list <- function() {
if (file.exists("imgList.tsv")) {
img.list <- read_tsv("imgList.tsv")
} else {
get.ortho.list()
get.nih.list()
img.list <- full_join(ortho.img.list, nih.img.list) %>%
rowid_to_column("id") %>%
write_tsv("imgList.tsv")
gcs_upload("imgList.tsv")
}
}
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
source('~/projects/R/xr/xray/scrape_OL.R', echo=TRUE)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
View(img.list)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
View(img.list)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
ortho.img.list <- get.ortho.list()
nih.img.list <- get.nih.list()
img.list <- full_join(ortho.img.list, nih.img.list)
img.list <- get.img.list()
img.list <- full_join(ortho.img.list, nih.img.list)
img.list
get.img.list <- function() {
if (file.exists("imgList.tsv")) {
img.list <- read_tsv("imgList.tsv")
} else {
ortho.img.list <- get.ortho.list()
nih.img.list <- get.nih.list()
img.list <- full_join(ortho.img.list, nih.img.list)
img.list <- rowid_to_column(img.list, "id")
write_tsv(img.list, "imgList.tsv")
gcs_upload("imgList.tsv")
}
}
img.list <- get.img.list()
img.list <- get.img.list()
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
View(img.list)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
img.list[1:10,]
img.list[12345:12354,]
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
temp.img.list <- img.list[12345:12364,]
apply(temp.img.list, 1, get.img)
temp.img.list <- img.list
temp.img.list <- img.list[1:10,]
apply(temp.img.list, 1, get.img)
temp.img.list
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
temp.img.list <- img.list[12345:12364,]
apply(temp.img.list, 1, get.img)
nih.img.list
temp.img.list <- img.list[429:430,]
temp.img.list
apply(img.list[429:length(img.list),], 1, get.img)
apply(img.list[429:125252,], 1, get.img)
list.files
list.files("img")
View("img/10900.png")
temp.img.list
id <- temp.img.list$id[1]
id
filepath <- file.path
filepath <- file.path("img", str_c(id, ".png"))
library(tidyverse)
filepath <- file.path("img", str_c(id, ".png"))
imgUrl <- temp.img.list$imgURL[1]
library(magick)
img <- image_read(imgUrl)
img <- image_convert(img, format = "png")
img
library(googleCloudStorageR)
imgFinal <- image_write(img, filepath)
gcs_upload(imgFinal)
gcs_list_objects()
gcs_upload(str_c("img/", imgFinal))
imgFinal
gcs_delete_object(imgFinal)
gcs_delete_object("img/429.png")
gcs_delete_object("imgFinal")
save_image <- function(img) {
gcs_upload(image_write(img, filepath))
}
temp.img.list$imgURL[1] %>%
image_read() %>%
image_convert(format = "png") %>%
save_image()
gcs_list_objects()
gcs_delete_object("image_write(img, filepath")
gcs_delete_object("image_write(img, filepath)")
gcs_list_objects()
save_image <- function(img) {
image_write(img, filepath) %>%
gcs_upload()
}
temp.img.list$imgURL[1] %>%
image_read() %>%
image_convert(format = "png") %>%
save_image()
temp.img.list$imgURL[1] %>%
image_read() %>%
image_convert(format = "png") %>%
save_image() %>%
image_write(filepath) %>%
gcs_upload
temp.img.list$imgURL[1] %>%
image_read() %>%
image_convert(format = "png") %>%
image_write(filepath) %>%
gcs_upload()
list.files("img")
for (i in list.files("img")) {
gcs_upload(i)
}
for (i in list.files("img")) {
gcs_upload(i)
}
for (i in list.files("img")) {
x <- file.path("img", i)
gcs_upload(x)
}
gcs_list_objects()
gcs_delete_object("x")
for (i in list.files("img")) {
x <- file.path("img", i)
gcs_upload("x")
}
get_wd()
getwd()
gcs_save_all("img")
gcs_list_objects()
temp.img.list$imgURL[2] %>%
image_read() %>%
image_convert(format = "png") %>%
save_image()
get.img(temp.img.list)
apply(temp.img.list, 1, get.img)
gcs_save_all("img")
gcs_delete_object("img")
gcs_list_objects()
gcs_upload("img/429.png", name=deparse(substitute("img/429.png")))
gcs_list_objects()
gcs_delete_object("img/429.png")
gcs_list_objects()
imgFiles <- list.files("img")
lapply(imgFiles, function(x) gcs_upload(x, name=x))
lapply(imgFiles, function(x) gcs_upload(x, name=file.path("img",x)))
lapply(imgFiles, function(x) gcs_upload(x, name=str_c("img",x)))
lapply(imgFiles, function(x) gcs_upload(x, name=str_c("img/",x))
)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
img.list <- get.img.list()
apply(img.list[429:125252], 1, get.img)
apply(img.list[429:125252,], 1, get.img)
length(list.files("img"))
9753 +428
length(list.files("img"))
length(list.files("img"))
file.exists("img/10181.png")
file.exists("img/10180.png")
file.exists("img/1.png")
file.exists("1.png")
file.exists(file.path("img", "1.png"))
file.exists(file.path("img", "429.png"))
file.exists("429.png")
file.exists(file.path("img", "10181.png"))
file.exists(file.path("img", "10180.png"))
file.exists(file.path("img", "10100.png"))
file.exists(file.path("img", "97533.png"))
length(list.files("img"))
97533 + 428
file.exists(file.path("img", "97961.png"))
file.exists(file.path("img", "97960.png"))
file.exists(file.path("img", "97553.png"))
file.exists(file.path("img", "429.png"))
file.exists(file.path("img", "97979.png"))
file.exists(file.path("img", "97979.png"))
file.exists(file.path("img", "429.png"))
setwd("img")
file.exists("429.png")
fixe.exists("1429.png")
file.exists("1429.png")
quit()
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
list.files("img")
apply(img.list[429:431,], 1, get.img)
list.files("img")
apply(img.list[1000:1002,], 1, get.img)
list.files("img")
list.files("img")
apply(img.list[1000:1002,], 1, get.img)
apply(img.list[1000:1002,], 1, get.img)
apply(img.list[1000:1002,], 1, get.img)
apply(img.list[429:125252,], 1, get.img)
list.files("img")
apply(img.list[1:428,], 1, get.img)
setwd
setwd("img")
file.exists("2.png")
file.exists("4.png")
file.exists("5.png")
setwd("~/projects/R/xr/xray")
apply(img.list[6:428,], 1, get.img)
View(ortho.img.list)
file.exists(file.path("img","50.png"))
file.exists(file.path("img","49.png"))
apply(img.list[51:428,], 1, get.img)
apply(img.list[52:428,], 1, get.img)
file.exists(file.path("img","101.png"))
file.exists(file.path("img","100.png"))
apply(img.list[102:428,], 1, get.img)
file.exists(file.path("img","111.png"))
file.exists(file.path("img","112.png"))
apply(img.list[113:428,], 1, get.img)
file.exists(file.path("img","129.png"))
apply(img.list[130:428,], 1, get.img)
file.exists(file.path("img","132.png"))
apply(img.list[133:428,], 1, get.img)
file.exists(file.path("img","136.png"))
apply(img.list[137:428,], 1, get.img)
file.exists(file.path("img","137.png"))
file.exists(file.path("img","138.png"))
apply(img.list[138:428,], 1, get.img)
apply(img.list[139:428,], 1, get.img)
apply(img.list[148:428,], 1, get.img)
apply(img.list[151:428,], 1, get.img)
apply(img.list[176:428,], 1, get.img)
apply(img.list[184:428,], 1, get.img)
apply(img.list[185:428,], 1, get.img)
apply(img.list[196:428,], 1, get.img)
apply(img.list[199:428,], 1, get.img)
apply(img.list[234:428,], 1, get.img)
apply(img.list[310:428,], 1, get.img)
apply(img.list[316:428,], 1, get.img)
apply(img.list[321:428,], 1, get.img)
apply(img.list[328:428,], 1, get.img)
apply(img.list[329:428,], 1, get.img)
apply(img.list[377:428,], 1, get.img)
apply(img.list[378:428,], 1, get.img)
apply(img.list[402:428,], 1, get.img)
apply(img.list[412:428,], 1, get.img)
length(list.files("img"))
img.list$imgURL[5]
img.list$imgURL[1:5]
"http://www.orthopaediclist.com/images/uploaded/2003-10-31%20AP%20%20Post-Op%20Healing49107-opt.jpg"
download.file(img.list$imgURL[5])
download.file(img.list$imgURL[5], "5.jpg")
URLencode(img.list$imgURL[5])
download.file(URLencode(img.list$imgURL[5]), "5.jpg")
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(img., margin, ...)
source('~/projects/R/xr/xray/scrape_OL.R', echo=TRUE)
View(ortho.img.list)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
View(img.list)
View(ortho.img.list)
gcs_list_objects()
gcs_delete_object("orthoList.tsv")
gcs_delete_object("imgList.tsv")
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
View(img.list)
gcs_list_objects()
gcs_delete_object("imgList.tsv")
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
source('~/projects/R/xr/xray/scrape_OL.R', echo=TRUE)
View(ortho.img.list)
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
View(img.list)
gcs_list_objects()
gcs_upload("imgList.tsv")
gcs_list_objects()
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(img.list[1:428], 1, get.img)
apply(img.list[1:428,], 1, get.img)
apply(img.list[1:2,], 1, get.img)
img.list[1:2,]
source('~/projects/R/xr/xray/load_img_lists.R', echo=TRUE)
apply(img.list[1:2,], 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(img.list[1:2,], 1, get.img)
apply(img.list[1:2,], 1, get.img)
id <- img.list$id[1]
filename <- str_c(id, ".png")
filename <- str_trim(filename)
filepath <- file.path("img", filename)
img <- img.list$imgURL[1]
img <- image_read(img)
img <- image_convert(img, format = "png")
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(img.list[1:428,], 1, get.img)
View(ortho.img.list)
apply(img.list[378:428,], 1, get.img)
View(img.list)
img.list %>%
img.list %>%
id <- img.list[1]
filename <- str_c(id, ".png") %>% str_trim()
rm(filename)
filename <- str_c(id, ".png")
filename
rm(filename)
id[1]
filename <- str_c(id[1], ".png")
rm(filename)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
temp.img.list <- img.list[1:10]
temp.img.list <- img.list[1:10,]
View(temp.img.list)
apply(temp.img.list, 1, get.img)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
mutate(temp.img.list, img = file.path("img", str_c(temp.img.list[1], ".png")))
temp.img.list$img <- NULL
temp.img.list
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
typeof(temp.img.list)
source('~/projects/R/xr/xray/img_download.R', echo=TRUE)
apply(temp.img.list, 1, get.img)
View(temp.img.list)
temp.img.list %>% as_tibble()
temp.img.list %>%
as_tibble() %>%
mutate( img = str_c("img/", id, ".png"))
temp.img.list$img[1]
temp.img.list
temp.img.list <- temp.img.list %>%
as_tibble() %>%
mutate(img = str_c("img/", id, ".png"))
View(temp.img.list)
file.exists(file.path("img","1.png"))
source('~/.active-rstudio-document', echo=TRUE)
View(img.list)
source('~/.active-rstudio-document', echo=TRUE)
View(img.list)
source('~/.active-rstudio-document', echo=TRUE)
View(img.list)
img.list[377,]
summary(img.list)
dim(img.list)
img.list[377,] <- NULL
img.list[377,]
img.list[-c(377),]
img.list[377,]
sampy <- img.list[-c(377),]
sampy[377,]
file.exists(file.path("img", "377.png"))
file.exists(file.path("img", "378.png"))
file.exists(img.list$imgLocal[377])
file.exists(img.list$imgLocal[378])
img.list <- img.list[-c(377),]
write_tsv(img.list, "imgList.tsv")
gcs_upload("imgList.tsv")
gcs_save_all("img", bucket = "xray.orthodoc.in")
gcs_list_objects()
